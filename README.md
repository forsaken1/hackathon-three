# Игра "Battle of Gods"

## Проект

### Тесты

`mocha -R spec` запуск тестов

# Описание игры

##  Сюжет: 

Боги решили померяться силами и в очередной раз разобраться кто из них главный (тут можно завести статистику по боям и выдавать результаты не только по игрокам, но и по богам).

____________________________

## Примерные действия пользователя для входа в бой:

1. Запуск, появляется меню игры (с пунктами "Играть", "Статистика", "Настройки", "Об Игре").
2. Нажимаем "Играть" и попадает на экран выбора персонажа.
3. Игрок выбирает персонажа и вводит никнейм в поле (или не вводит, если уже играл, сервер его запоминает).
4. Нажимает "В бой!" и попадает на экран битвы.
5. Тут сервер или ищет ему оппонента из тех, что в ожидании, или ставит текущего пользователя в режим ожидания. Если игрок в режиме ожидания, то показываем ему спиннер с просьбой подождать.
6. Начинается бой.

## Дополнительные действия:

1. Статистика по боям.
2. Информация об игре.
3. Настройки (вот тут надо бы придумать, что там изменять).
4. Игрок может выйти из боя досрочно, тем самым проиграв бой. Паузы не предусмотрено =)

__________________________

## Геймплей:

Поле битвы

Два игрока друг напротив друга

У пользователя две кнопки, с помощью которых он воздействует на игру: атака и защита.

Персонаж пользователя может находиться в трех состояниях: атака, защита и нейтральный (ничего не делает).

У персонажа пользователя есть два важных показателя: здоровье и мана.

Здоровье, по умолчанию = 100, при достижении 0 персонаж умирает. Здоровье уменьшается посредством атак противника. В режиме защиты здоровье уменьшается с половинной скоростью.

Мана, по умолчанию = 100, при достижении 0 персонаж не может атаковать. Мана уменьшается при атаке персонажем своего противника. Мана увеличивается с номинальной скоростью когда персонаж находится в нейтральном состоянии. Мана увеличивается с половинной от номинальной скорости когда персонаж находится в режиме защиты.

В состоянии атаки персонаж наносит урон своему противнику. Он наносит номинальный урон, когда противник находится в нейтральном режиме и половинный урон, когда противник находится в режиме защиты. Мана игрока в состоянии атаки быстро уменьшается.

В состоянии защиты мана увеличивается с половинной скоростью и игрок получает половинный урон.

__________________________________

## Персонажи:

Зевс - бог громовержец. Атака - молния и защита щитом.

Аид - бог подземного мира. Атака - синий файрбол (как на башке в диснеевском мультике). защита - у него есть меч и шлем, надо что-то придумать

Посейдон (можно сделать бонусным) - бог морей. Атака - трезубец с вырывающейся из него хуетой, защита - вода или что-то в этом роде. Водная стена, например.
______________________________________

## Дальнейшее развитие игры (если успеем):

Бонусы на экране битвы.

# Серверная часть

## Базовые:

`connect` - при входе в игру

`disconnect` - при выходе из игры или разрыве соединения

____________________________

## События клиента (шлет их серверу):

`play { id: 'fsds412df', nickname: 'lexa', character: 'z' }` - войти в игру с никнеймом и выбранным персонажем

`out { id: 'sdfsd' }` - выйти из игры в главное меню

`attack { id: 'sdsg }` - атака. Пользователь нажал кнопку "Атака" и событие отсылается на сервер.

`defence_start/stop { id: 'sdfsdf' }` - защита, то же самое, что и атака, но отсылается при нажатии/отпускании кнопки "Защита".
____________________________

## События сервера (шлет клиенту):

`waiting` - ожидание начала игры, когда второй пользователь еще не подсоединился

`start { first_player_id: { id: 'fgdg', name: 'stas', character: 'p' }, second_player: { id: 'fdfd', name: 'andrey', character: 'z' } }` - событие начала игры, когда оба игрока подключились и готовы к бою.

`end { id: 'sdfd', result: true/false }` - сообщение о конце игры и результатом битвы.

`tick { first_player_id: { id: 'dfdf', health: 100, mana: 54, action: 'a' }, second_player: { id: 'gfgf', health: 56, mana: 100, action: 'd' } }`  - отсылается массив игровых параметров при каждом изменении состояния игры. Health - здоровье персонажа от 0 до 100 (рисуем полоску здоровья), Mana - очки действия персонажа, от 0 до 100, action - текущее действие персонажа, где 'a' - атака, 'd' - защита, 'n'  - ничего.
___________________________________

## Последовательность событий

#### (действие пользователя - логика взаимодействия клиента и сервера и описание их работы):

1. Пользователь запускает игру и попадает в главное меню игры - игра подсоединяется к серверу, на сервере выполняется событие `connection` 

2. Пользователь жмакает пункт меню "Играть" и попадает в меню выбора персонажа. Тут никакого взаимодействия не производится.

3. Пользователь выбирает персонажа и попадает на экран битвы - тут клиент шлет серверу событие `play` с json `{ id: 'df32df', name: 'andrey', character: 'z' }`, где `id` - уникальный идентификатор устройства, `name` - ник пользователя в игре (хранить на клиенте, спрашивать ввод при первом запуске), `character` - идентификатор персонажа. 
Сервер ловит сообщение и тут возникают два варианта: 
One. если очередь ожидания пуста, он создает объект Игрок и ставит его в очередь ожидания, на клиент отсылается событие `waiting`, клиент показывает спиннер.
Two. если очередь ожидания не пуста, он выбирает второго игрока и помещает их объект Битва, шлет на клиент событие `start`, клиент ловит событие и рисует игрокам поле боя. 
Для пользователя эти два варианта исполняются так: если пользователь в очереди подключения, то игроку показывается спиннер с надписью "Ожидается подключение второго игрока", иначе начинается битва.

4. При нажатии кнопки "Атака", отсылается событие `attack` на сервер. При нажатии кнопки "Защита" отсылается событие `defence_start`. При отпускании кнопки запускается событие `defence_stop`. Для пользователя это <переход в атакующую стойку и выстрел> и <переход в защитную стойку> соответственно. (сервер: для атаки будет кулдаун N тиков).

5. При совершении событий Атака и Защита состояние игры будет изменяться, т.е. такие показатели как Здоровье и Мана. Для их обновления на клиенте будет отсылаться с сервера событие `tick` с json `{ iam: { health: 1, mana: 0, action: 'a' }, enemy: { health: 40, mana: 30, action: 'd' } }`

6. Если один из игроков погиб, то сервер шлет событие `end` с json `{ result: true/false }`, и клиент в зависимости от переменной `result` показывает сообщение о победе или поражении. true - победа.

При возврате в главное меню до конца боя шлем событие `out`, при этом второму игроку шлется событие `end` с json `{ result: true }`
